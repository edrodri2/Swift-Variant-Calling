@dispatch=WORKER
(file t) write(string s)
    "turbine" "0.0.2" "file_write"
    [ "turbine::file_write_local <<t>> <<s>>" ];



proc file_write { outputs inputs } {
        rule_file_helper "write_file" $inputs \
            $outputs [ list ] \
            $::turbine::WORK \
            "file_write_body $outputs $inputs"
    }


proc file_write_body { dst str } {
        set str_val [ retrieve_decr_string $str ]
        set d [ get_filename_val $dst ]
        ensure_directory_exists2 $d
        set fp [ ::open $d w+ ]
        puts -nonewline $fp $str_val
        close $fp
        close_file $dst
    }


file_write_local { local_file_name data } { 
        upvar $local_file_name local_file
        ensure_directory_exists2 $local_file_name
        set fp [ ::open [ local_file_path $local_file ] w+ ]
        puts -nonewline $fp $data
        close $fp 
    }   

